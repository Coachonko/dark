!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@dark-engine/core")):"function"==typeof define&&define.amd?define("DarkPlatformBrowser",["@dark-engine/core"],t):"object"==typeof exports?exports.DarkPlatformBrowser=t(require("@dark-engine/core")):e.DarkPlatformBrowser=t(e.DarkCore)}(self,(e=>(()=>{"use strict";var t={317:t=>{t.exports=e}},n={};function o(e){var r=n[e];if(void 0!==r)return r.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,o),a.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{o.r(r),o.d(r,{createPortal:()=>n,createRoot:()=>U,render:()=>B,setTrackUpdate:()=>x,useStyle:()=>W,version:()=>G});var e=o(317);const t=Symbol("portal");function n(e,n){if(!(n instanceof Element))throw new Error("[Dark]: createPortal receives only Element as container!");return a({[t]:n,slot:e})}const a=(0,e.createComponent)((n=>{var{slot:o}=n,r=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n}(n,["slot"]);return(0,e.useMemo)((()=>r[t].innerHTML=""),[]),o}),{token:t}),i=n=>(0,e.detectIsComponentFactory)(n)&&n.token===t,l=e=>i(e)?e.props[t]:null;class s{constructor(e){this.type="",this.sourceEvent=null,this.target=null,this.propagation=!0,this.type=e.sourceEvent.type,this.sourceEvent=e.sourceEvent,this.target=e.target}stopPropagation(){this.propagation=!1,this.sourceEvent.stopPropagation()}preventDefault(){this.sourceEvent.preventDefault()}getPropagation(){return this.propagation}}function c(t){const{target:n,eventName:o,handler:r}=t,a=e.eventsStore.get(),i=a.get(o);if(i)i.set(n,r);else{const t=t=>{const n=a.get(o).get(t.target),r=t.target;let i=null;(0,e.detectIsFunction)(n)&&(i=new s({sourceEvent:t,target:r}),n(i)),(i?i.getPropagation():r.parentElement)&&r.parentElement.dispatchEvent(new t.constructor(t.type,t))};a.set(o,new WeakMap([[n,r]])),document.addEventListener(o,t,!0),e.eventsStore.addUnsubscriber((()=>document.removeEventListener(o,t,!0)))}}const u=e=>e.startsWith("on"),f=e=>e.slice(2,e.length).toLowerCase(),m={[e.ATTR_KEY]:!0,[e.ATTR_REF]:!0,void:!0},p={svg:!0,animate:!0,animateMotion:!0,animateTransform:!0,circle:!0,clipPath:!0,defs:!0,desc:!0,ellipse:!0,feBlend:!0,feColorMatrix:!0,feComponentTransfer:!0,feComposite:!0,feConvolveMatrix:!0,feDiffuseLighting:!0,feDisplacementMap:!0,feDistantLight:!0,feDropShadow:!0,feFlood:!0,feFuncA:!0,feFuncB:!0,feFuncG:!0,feFuncR:!0,feGaussianBlur:!0,feImage:!0,feMerge:!0,feMergeNode:!0,feMorphology:!0,feOffset:!0,fePointLight:!0,feSpecularLighting:!0,feSpotLight:!0,feTile:!0,feTurbulence:!0,filter:!0,foreignObject:!0,g:!0,image:!0,line:!0,linearGradient:!0,marker:!0,mask:!0,metadata:!0,mpath:!0,path:!0,pattern:!0,polygon:!0,polyline:!0,radialGradient:!0,rect:!0,stop:!0,switch:!0,symbol:!0,text:!0,textPath:!0,tspan:!0,use:!0,view:!0};let d=new Map,g=null;const v={[e.NodeType.TAG]:e=>{const t=e;var n;return n=t.name,Boolean(p[n])?document.createElementNS("http://www.w3.org/2000/svg",t.name):document.createElement(t.name)},[e.NodeType.TEXT]:e=>{const t=e;return document.createTextNode(t.value)},[e.NodeType.COMMENT]:e=>{const t=e;return document.createComment(t.value)}};function h(t,n){(0,e.detectIsFunction)(t)?t(n):(0,e.detectIsMutableRef)(t)&&(t.current=n)}const E={value:!0,checked:!0},y={value:!0},T={selected:!0},b={},w={input:(e,t,n)=>(E[t]&&(e[t]=n),E),textarea:(e,t,n)=>(y[t]&&(e[t]=n),y),option:(e,t,n)=>(T[t]&&(e[t]=n),T)};function k(e){const{tagName:t,element:n,name:o,value:r}=e,a=w[t];return a?a(n,o,r):b}function M(e){let t=e;for(;t;)if(t=t.parent,i(t.instance)&&(t.nativeElement=l(t.instance)),t.nativeElement)return t;return t}function S(t){const n=M(t).nativeElement,o=n.childNodes;0===o.length||function(e,t){var n;let o=e;for(;o;){if((null===(n=null==o?void 0:o.parent)||void 0===n?void 0:n.nativeElement)===t)return o.idx;o=o.parent}return-1}(t,n)>o.length-1?((e,t)=>{const{fragment:n}=d.get(t)||{fragment:document.createDocumentFragment(),callback:()=>{}};d.set(t,{fragment:n,callback:()=>{t.appendChild(n)}}),n.appendChild(e.nativeElement),e.markMountedToHost()})(t,n):((t,n)=>{n.insertBefore(t.nativeElement,function(t,n){let o=null;return(0,e.walkFiber)(t,(({nextFiber:e,stop:t,resetIsDeepWalking:r})=>e.nativeElement&&e.nativeElement.parentElement===n?(o=e.nativeElement,t()):e.mountedToHost?void 0:r())),o}(t,n)),t.markMountedToHost()})(t,n),function(t,n){if(!(0,e.detectIsTagVirtualNode)(n))return;const o=Object.keys(n.attrs);for(const r of o){const o=n.attrs[r];r!==e.ATTR_REF?(0,e.detectIsFunction)(o)?u(r)&&c({target:t,handler:o,eventName:f(r)}):(0,e.detectIsUndefined)(o)||m[r]||!k({tagName:n.name,value:o,name:r,element:t})[r]&&t.setAttribute(r,o):h(o,t)}}(t.nativeElement,t.instance)}const P={[e.EffectTag.CREATE]:e=>{null!==e.nativeElement&&(g&&g(e.nativeElement),S(e))},[e.EffectTag.UPDATE]:t=>{var n,o,r;null!==t.nativeElement&&(0,e.detectIsVirtualNode)(t.alternate.instance)&&(0,e.detectIsVirtualNode)(t.instance)&&(g&&g(t.nativeElement),n=t.nativeElement,o=t.alternate.instance,r=t.instance,(0,e.detectIsTextVirtualNode)(o)&&(0,e.detectIsTextVirtualNode)(r)&&o.value!==r.value?n.textContent=r.value:(0,e.detectIsTagVirtualNode)(o)&&(0,e.detectIsTagVirtualNode)(r)&&function(t,n,o){const r=new Set([...Object.keys(n.attrs),...Object.keys(o.attrs)]);for(const a of r){const r=n.attrs[a],i=o.attrs[a];a!==e.ATTR_REF?(0,e.detectIsUndefined)(i)?t.removeAttribute(a):(0,e.detectIsFunction)(r)?u(a)&&r!==i&&c({target:t,handler:i,eventName:f(a)}):m[a]||r===i||!k({tagName:o.name,value:i,name:a,element:t})[a]&&t.setAttribute(a,i):h(r,t)}}(n,o,r))},[e.EffectTag.DELETE]:t=>function(t){const n=M(t);(0,e.walkFiber)(t,(({nextFiber:e,isReturn:o,resetIsDeepWalking:r,stop:a})=>e===t.nextSibling||e===t.parent?a():!o&&e.nativeElement?(!i(e.instance)&&n.nativeElement.removeChild(e.nativeElement),r()):void 0))}(t),[e.EffectTag.SKIP]:()=>{}};function x(e){g=e}const I={hight:[],normal:[],low1:[],low2:[]};let N=null,O=0,C=!1,F=null;class R{constructor(e){this.id=++R.nextTaskId,this.time=e.time,this.timeoutMs=e.timeoutMs,this.priority=e.priority,this.forceSync=e.forceSync,this.callback=e.callback}}function L(t){return!!t.length&&(F=t.shift(),F.callback(),F.forceSync?function(e){for(;e(););A(),F=null}(e.workLoop):(n=e.workLoop,N=n,C||(C=!0,j.postMessage(null))),!0);var n}function A(){Boolean(e.wipRootStore.get())||function(){const[t]=I.low2;return!!(t&&(0,e.getTime)()-t.time>t.timeoutMs)&&(L(I.low2),!0)}()||(I.low1.length>1e5&&(I.low1=[]),0)||L(I.hight)||L(I.normal)||requestIdleCallback((()=>L(I.low1)||L(I.low2)))}R.nextTaskId=0;let D=null,j=null;D=new MessageChannel,j=D.port2,D.port1.onmessage=function(){if(N){O=(0,e.getTime)()+4;try{N()?j.postMessage(null):(F=null,C=!1,N=null,A())}catch(e){throw j.postMessage(null),e}}else C=!1},e.platform.createNativeElement=function(e){return v[e.type](e)},e.platform.requestAnimationFrame=requestAnimationFrame.bind(void 0),e.platform.scheduleCallback=function(t,n){const{priority:o=e.TaskPriority.NORMAL,timeoutMs:r=0,forceSync:a=!1}=n||{},i=new R({time:(0,e.getTime)(),timeoutMs:r,priority:o,forceSync:a,callback:t});({[e.TaskPriority.HIGH]:()=>I.hight.push(i),[e.TaskPriority.NORMAL]:()=>I.normal.push(i),[e.TaskPriority.LOW]:()=>i.timeoutMs>0?I.low2.push(i):I.low1.push(i)})[i.priority](),A()},e.platform.shouldYeildToHost=()=>(0,e.getTime)()>=O,e.platform.applyCommit=function(e){P[e.effectTag](e)},e.platform.finishCommitWork=function(){for(const{callback:e}of d.values())e();d=new Map},e.platform.detectIsPortal=i,e.platform.unmountPortal=function(e){const t=l(e.instance);t&&(t.innerHTML="")};const H=new Map;function B(t,n){if(!(n instanceof Element))throw new Error("[Dark]: render receives only Element as container!");const o=!(0,e.detectIsUndefined)(H.get(n));let r=null;o?r=H.get(n):(r=H.size,H.set(n,r),n.innerHTML=""),e.platform.scheduleCallback((()=>{e.rootStore.set(r);const a=e.currentRootStore.get(),i=new e.Fiber({nativeElement:n,instance:new e.TagVirtualNode({name:e.ROOT,children:(0,e.flatten)([t||(0,e.createEmptyVirtualNode)()])}),alternate:a,effectTag:o?e.EffectTag.UPDATE:e.EffectTag.CREATE});a&&(a.alternate=null),e.fiberMountStore.reset(),e.wipRootStore.set(i),e.nextUnitOfWorkStore.set(i)}),{priority:e.TaskPriority.NORMAL,forceSync:e.isLayoutEffectsZone.get()})}function U(t){return{render:e=>B(e,t),unmount:()=>{const n=H.get(t);(0,e.unmountRoot)(n,(()=>{H.delete(t),t.innerHTML=""}))}}}function V(t,...n){return(0,e.useMemo)((()=>t.map(((t,o)=>t+((0,e.detectIsUndefined)(n[o])?"":n[o]))).join("").replace(/;\s*/gm,";").replace(/:\s*/gm,":").trim()),[t,...n])}function W(e){return e(V)}const G="0.9.12"})(),r})()));
//# sourceMappingURL=dark-platform-browser.production.min.js.map