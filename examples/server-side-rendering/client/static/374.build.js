"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[374],{6374:(e,t,i)=>{i.r(t),i.d(t,{default:()=>u});var n=i(2654),r=i(3524),a=i(1523),c=i(940),o=i(5450),d=i(9041),s=i(5010);const u=(0,n.wU)((()=>{const{url:e}=(0,a.b)(),t=(0,c.k)(),i=(0,o.U)(),n=Number(i.get("id")),[u,{loading:l}]=(0,d.jb)(n),f=e.replace(`${n}/remove/`,"");return(0,r.h)(s.Zb,{$loading:l},(0,r.h)("h3",null,"Do you want to remove product #",n,"? ðŸ¤”"),(0,r.h)(s.zx,{onClick:async()=>{l||(await u(),t.push(f))}},"Yes"),(0,r.h)(s.zx,{onClick:()=>t.back()},"No"))}))},9041:(e,t,i)=>{i.d(t,{N8:()=>I,oD:()=>C,iB:()=>b,rn:()=>U,jb:()=>R});var n,r=i(5747),a=i(9812),c=i(3760),o=i(7544),d=i(6238),s=i(8047),u=i(4435),l=i(1261),f=i(3443);function h(e,t){const{variables:i={},key:n,extractId:h=(()=>r.kI),onBefore:y}=t||{variables:{}},m=(0,f.pj)(),g=(0,r.YT)(),k=h(i),P=(0,l.Y)((()=>m.getNextResourceId()),[]),T=(0,l.Y)((()=>function(e,t,i){const n={isFetching:!0,isLoaded:!1,data:null,error:null,cacheKey:t,cacheId:i};if(e){const r=e.read({key:t,id:i});r&&(n.isFetching=!1,n.isLoaded=!0,n.data=r.data)}return n}(g,n,k)),[]),{register:w,unregister:v}=(0,s.h)(),[U,b]=function(){const e=(0,l.Y)((()=>({isMounted:!0,isFirstTime:!0})),[]),{isFirstTime:t}=e;return(0,c.b)((()=>(e.isFirstTime=!1,()=>e.isMounted=!1)),[]),[()=>e.isMounted,()=>t]}(),I=(0,u.P)(),C=()=>U()&&I(),R=(0,o.X)(),D=m.getIsHydrateZone(),{isLoaded:S}=T;T.cacheKey=n,T.cacheId=k;const F=async(t,r)=>{const c=t?r:i,o=h(c);(0,a.EY)(y)&&y();try{R||b()||(T.isFetching=!0,C());const t=await e(c);return R?m.setResource(P,[t,null]):(v(P),T.data=t,T.isFetching=!1,T.error=null),n&&g&&t&&g.write({key:n,id:o,data:t}),t}catch(e){(0,a.vU)(e),R?m.setResource(P,[null,String(e)]):(v(P),T.isFetching=!1,T.error=String(e))}finally{R||(T.isLoaded=!0,C())}};if((0,d.d4)((()=>{if(!D){if(n&&g&&g.read({key:n,id:k})?.valid)return;F()}}),[...(0,a.Yl)(i)]),(0,d.d4)((()=>{let e=null;return g&&(e=g.subscribe((({type:e,key:t,id:i})=>{t===T.cacheKey&&i===T.cacheId&&("invalidate"!==e&&"optimistic"!==e||g.canUpdate(t)&&F())}))),()=>{v(P),(0,a.EY)(e)&&e()}}),[]),R||D){const e=m.getResource(P);if(R)e?p(T,e):m.defer(F);else if(D){if(!e)throw new Error("[Dark]: can not read app state from the server!");const[t]=e;p(T,e),n&&g&&t&&g.write({key:n,id:k,data:t})}}else b()&&!S&&w(P);const O={loading:T.isFetching,data:T.data,error:T.error,refetch:e=>F(!0,e)};return O}function p(e,t){const[i,n]=t;e.isFetching=!1,e.isLoaded=!0,e.data=i,e.error=n}function y(e,t){const{refetchQueries:i=[],onSuccess:n}=t||{},c=(0,u.P)(),o=(0,r.YT)(),d=(0,l.Y)((()=>({isFetching:!1,data:null,error:null})),[]);return[async(...t)=>{let r=null;try{d.isFetching=!0,d.error=null,c(),r=await e(...t),(0,a.EY)(n)&&n(o,r),i.forEach((e=>o.invalidate({key:e})))}catch(e){(0,a.vU)(e),d.error=String(e)}finally{d.isFetching=!1,c()}return r},{loading:d.isFetching,data:d.data,error:d.error}]}!function(e){e.PRODUCTS="products",e.PRODUCT_ITEM="product-item"}(n||(n={}));const m=void 0===globalThis.window?100:600,g=e=>new Promise((t=>setTimeout(t,e)));let k=0;const P=new Array(50).fill(null).map((()=>({id:++k,name:`Product #${k}`,description:"Lorem ipsum dolor sit amet consectetur, adipisicing elit. Nostrum blanditiis quia minus corrupti quidem. Ipsam quae ad velit repudiandae molestias unde".repeat(3)}))),T={fetchProducts:async()=>(await g(m),P.map((e=>({...e,description:null})))),fetchProduct:async e=>(w(e)||v(),await g(m),P.find((t=>t.id===e))||null),addProduct:async e=>(w(e.id)&&v(),await g(m),e.id=++k,P.push(e),e),async changeProduct(e){if(w(e.id)||v(),!e)return null;await g(m);const t=P.findIndex((t=>t.id===e.id));return-1!==t&&P.splice(t,1,e),e},async removeProduct(e){w(e)||v(),await g(m);const t=P.findIndex((t=>t.id===e));return-1!==t&&P.splice(t,1),!0}},w=e=>"number"==typeof e&&!Number.isNaN(e),v=()=>{throw new Error("Invalid id!")};function U(){return h((()=>T.fetchProducts()),{key:n.PRODUCTS,onBefore:()=>console.log("[fetch]: products")})}function b(e){return h((({id:e})=>T.fetchProduct(e)),{variables:{id:e},key:n.PRODUCT_ITEM,extractId:e=>e.id,onBefore:()=>{console.log("[fetch]: product",e)}})}function I(){return y(T.addProduct,{onSuccess:(e,t)=>{const i=e.read({key:n.PRODUCTS});if(i){const r=i.data;r.push(t),e.optimistic({key:n.PRODUCTS,data:r})}}})}function C(){return y(T.changeProduct,{onSuccess:(e,t)=>{const i=e.read({key:n.PRODUCTS});if(i){const r=i.data;r.find((e=>e.id===t.id)).name=t.name,e.optimistic({key:n.PRODUCTS,data:r}),e.optimistic({key:n.PRODUCT_ITEM,data:t,id:t.id})}}})}function R(e){return y((()=>T.removeProduct(e)),{onSuccess:t=>{const i=t.read({key:n.PRODUCTS});if(i){const r=i.data,a=r.findIndex((t=>t.id===e));-1!==a&&(r.splice(a,1),t.optimistic({key:n.PRODUCTS,data:r}))}t.delete({key:n.PRODUCT_ITEM,id:e})}})}},1523:(e,t,i)=>{i.d(t,{b:()=>c});var n=i(1261),r=i(3113),a=i(3397);function c(){const e=(0,r.M6)();(0,r.BU)(e);const t=(0,r._L)(),{location:{pathname:i}}=e,c=(0,n.Y)((()=>t?(0,a.L7)(i,t):""),[t,i]);return{path:t,url:c}}},5450:(e,t,i)=>{i.d(t,{U:()=>r});var n=i(3113);function r(){const e=(0,n.M6)();return(0,n.BU)(e),e.params}}}]);
//# sourceMappingURL=374.build.js.map