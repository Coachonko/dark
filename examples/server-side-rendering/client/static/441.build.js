"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[441],{6441:(e,t,i)=>{i.r(t),i.d(t,{default:()=>u});var n=i(2654),r=i(3524),a=i(5450),c=i(1523),o=i(940),d=i(9041),s=i(5010);const u=(0,n.wU)((()=>{const e=(0,a.U)(),{url:t}=(0,c.b)(),i=(0,o.k)(),n=Number(e.get("id")),{data:u}=(0,d.iB)(n),[l,{loading:f}]=(0,d.oD)(),h=t.replace(`${n}/edit/`,"");return(0,r.h)(s.Zb,{$loading:f},(0,r.h)("h3",null,"Edit product"),(0,r.h)(s.l0,{onSubmit:async e=>{e.preventDefault();const t=e.target.elements.name.value,n=e.target.elements.desc.value;f||(await l({...u,name:t,description:n}),i.push(h))}},(0,r.h)("label",{for:"name"},"Name:"),(0,r.h)(s.II,{id:"name",required:!0,value:u.name}),(0,r.h)("label",{for:"desc"},"Description:"),(0,r.h)(s.gx,{id:"desc",required:!0,rows:5,value:u.description}),(0,r.h)(s.zx,{type:"submit"},"Edit")))}))},9041:(e,t,i)=>{i.d(t,{N8:()=>I,oD:()=>D,iB:()=>U,rn:()=>b,jb:()=>R});var n,r=i(5747),a=i(9812),c=i(3760),o=i(7544),d=i(6238),s=i(8047),u=i(4435),l=i(1261),f=i(3443);function h(e,t){const{variables:i={},key:n,extractId:h=(()=>r.kI),onBefore:m}=t||{variables:{}},y=(0,f.pj)(),g=(0,r.YT)(),P=h(i),k=(0,l.Y)((()=>y.getNextResourceId()),[]),v=(0,l.Y)((()=>function(e,t,i){const n={isFetching:!0,isLoaded:!1,data:null,error:null,cacheKey:t,cacheId:i};if(e){const r=e.read({key:t,id:i});r&&(n.isFetching=!1,n.isLoaded=!0,n.data=r.data)}return n}(g,n,P)),[]),{register:T,unregister:w}=(0,s.h)(),[b,U]=function(){const e=(0,l.Y)((()=>({isMounted:!0,isFirstTime:!0})),[]),{isFirstTime:t}=e;return(0,c.b)((()=>(e.isFirstTime=!1,()=>e.isMounted=!1)),[]),[()=>e.isMounted,()=>t]}(),I=(0,u.P)(),D=()=>b()&&I(),R=(0,o.X)(),S=y.getIsHydrateZone(),{isLoaded:C}=v;v.cacheKey=n,v.cacheId=P;const F=async(t,r)=>{const c=t?r:i,o=h(c);(0,a.EY)(m)&&m();try{R||U()||(v.isFetching=!0,D());const t=await e(c);return R?y.setResource(k,[t,null]):(w(k),v.data=t,v.isFetching=!1,v.error=null),n&&g&&t&&g.write({key:n,id:o,data:t}),t}catch(e){(0,a.vU)(e),R?y.setResource(k,[null,String(e)]):(w(k),v.isFetching=!1,v.error=String(e))}finally{R||(v.isLoaded=!0,D())}};if((0,d.d4)((()=>{if(!S){if(n&&g&&g.read({key:n,id:P})?.valid)return;F()}}),[...(0,a.Yl)(i)]),(0,d.d4)((()=>{let e=null;return g&&(e=g.subscribe((({type:e,key:t,id:i})=>{t===v.cacheKey&&i===v.cacheId&&("invalidate"!==e&&"optimistic"!==e||g.canUpdate(t)&&F())}))),()=>{w(k),(0,a.EY)(e)&&e()}}),[]),R||S){const e=y.getResource(k);if(R)e?p(v,e):y.defer(F);else if(S){if(!e)throw new Error("[Dark]: can not read app state from the server!");const[t]=e;p(v,e),n&&g&&t&&g.write({key:n,id:P,data:t})}}else U()&&!C&&T(k);const E={loading:v.isFetching,data:v.data,error:v.error,refetch:e=>F(!0,e)};return E}function p(e,t){const[i,n]=t;e.isFetching=!1,e.isLoaded=!0,e.data=i,e.error=n}function m(e,t){const{refetchQueries:i=[],onSuccess:n}=t||{},c=(0,u.P)(),o=(0,r.YT)(),d=(0,l.Y)((()=>({isFetching:!1,data:null,error:null})),[]);return[async(...t)=>{let r=null;try{d.isFetching=!0,d.error=null,c(),r=await e(...t),(0,a.EY)(n)&&n(o,r),i.forEach((e=>o.invalidate({key:e})))}catch(e){(0,a.vU)(e),d.error=String(e)}finally{d.isFetching=!1,c()}return r},{loading:d.isFetching,data:d.data,error:d.error}]}!function(e){e.PRODUCTS="products",e.PRODUCT_ITEM="product-item"}(n||(n={}));const y=void 0===globalThis.window?100:600,g=e=>new Promise((t=>setTimeout(t,e)));let P=0;const k=new Array(50).fill(null).map((()=>({id:++P,name:`Product #${P}`,description:"Lorem ipsum dolor sit amet consectetur, adipisicing elit. Nostrum blanditiis quia minus corrupti quidem. Ipsam quae ad velit repudiandae molestias unde".repeat(3)}))),v={fetchProducts:async()=>(await g(y),k.map((e=>({...e,description:null})))),fetchProduct:async e=>(T(e)||w(),await g(y),k.find((t=>t.id===e))||null),addProduct:async e=>(T(e.id)&&w(),await g(y),e.id=++P,k.push(e),e),async changeProduct(e){if(T(e.id)||w(),!e)return null;await g(y);const t=k.findIndex((t=>t.id===e.id));return-1!==t&&k.splice(t,1,e),e},async removeProduct(e){T(e)||w(),await g(y);const t=k.findIndex((t=>t.id===e));return-1!==t&&k.splice(t,1),!0}},T=e=>"number"==typeof e&&!Number.isNaN(e),w=()=>{throw new Error("Invalid id!")};function b(){return h((()=>v.fetchProducts()),{key:n.PRODUCTS,onBefore:()=>console.log("[fetch]: products")})}function U(e){return h((({id:e})=>v.fetchProduct(e)),{variables:{id:e},key:n.PRODUCT_ITEM,extractId:e=>e.id,onBefore:()=>{console.log("[fetch]: product",e)}})}function I(){return m(v.addProduct,{onSuccess:(e,t)=>{const i=e.read({key:n.PRODUCTS});if(i){const r=i.data;r.push(t),e.optimistic({key:n.PRODUCTS,data:r})}}})}function D(){return m(v.changeProduct,{onSuccess:(e,t)=>{const i=e.read({key:n.PRODUCTS});if(i){const r=i.data;r.find((e=>e.id===t.id)).name=t.name,e.optimistic({key:n.PRODUCTS,data:r}),e.optimistic({key:n.PRODUCT_ITEM,data:t,id:t.id})}}})}function R(e){return m((()=>v.removeProduct(e)),{onSuccess:t=>{const i=t.read({key:n.PRODUCTS});if(i){const r=i.data,a=r.findIndex((t=>t.id===e));-1!==a&&(r.splice(a,1),t.optimistic({key:n.PRODUCTS,data:r}))}t.delete({key:n.PRODUCT_ITEM,id:e})}})}},1523:(e,t,i)=>{i.d(t,{b:()=>c});var n=i(1261),r=i(3113),a=i(3397);function c(){const e=(0,r.M6)();(0,r.BU)(e);const t=(0,r._L)(),{location:{pathname:i}}=e,c=(0,n.Y)((()=>t?(0,a.L7)(i,t):""),[t,i]);return{path:t,url:c}}},5450:(e,t,i)=>{i.d(t,{U:()=>r});var n=i(3113);function r(){const e=(0,n.M6)();return(0,n.BU)(e),e.params}}}]);
//# sourceMappingURL=441.build.js.map