"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[934],{7934:(e,t,i)=>{i.r(t),i.d(t,{default:()=>s});var r=i(2654),n=i(3524),a=i(1523),c=i(940),d=i(9041),o=i(5010);const s=(0,r.wU)((()=>{const{url:e}=(0,a.b)(),t=(0,c.k)(),[i,{loading:r}]=(0,d.N8)(),s=e.replace("add/","");return(0,n.h)(o.Zb,{$loading:r},(0,n.h)("h3",null,"Add product"),(0,n.h)(o.l0,{onSubmit:async e=>{if(e.preventDefault(),r)return;const{elements:n}=e.target,a=n.name.value,c=n.desc.value;await i({name:a,description:c}),t.push(s)}},(0,n.h)("label",{for:"name"},"Name:"),(0,n.h)(o.II,{id:"name",required:!0}),(0,n.h)("label",{for:"desc"},"Description:"),(0,n.h)(o.gx,{id:"desc",required:!0,rows:3}),(0,n.h)(o.zx,{type:"submit"},"Add")))}))},9041:(e,t,i)=>{i.d(t,{N8:()=>U,oD:()=>D,iB:()=>I,rn:()=>v,jb:()=>R});var r,n=i(5747),a=i(9812),c=i(3760),d=i(7544),o=i(6238),s=i(8047),u=i(4435),l=i(1261),f=i(3443);function h(e,t){const{variables:i={},key:r,extractId:h=(()=>n.kI),onBefore:m}=t||{variables:{}},y=(0,f.pj)(),g=(0,n.YT)(),P=h(i),k=(0,l.Y)((()=>y.getNextResourceId()),[]),T=(0,l.Y)((()=>function(e,t,i){const r={isFetching:!0,isLoaded:!1,data:null,error:null,cacheKey:t,cacheId:i};if(e){const n=e.read({key:t,id:i});n&&(r.isFetching=!1,r.isLoaded=!0,r.data=n.data)}return r}(g,r,P)),[]),{register:w,unregister:b}=(0,s.h)(),[v,I]=function(){const e=(0,l.Y)((()=>({isMounted:!0,isFirstTime:!0})),[]),{isFirstTime:t}=e;return(0,c.b)((()=>(e.isFirstTime=!1,()=>e.isMounted=!1)),[]),[()=>e.isMounted,()=>t]}(),U=(0,u.P)(),D=()=>v()&&U(),R=(0,d.X)(),S=y.getIsHydrateZone(),{isLoaded:C}=T;T.cacheKey=r,T.cacheId=P;const F=async(t,n)=>{const c=t?n:i,d=h(c);(0,a.EY)(m)&&m();try{R||I()||(T.isFetching=!0,D());const t=await e(c);return R?y.setResource(k,[t,null]):(b(k),T.data=t,T.isFetching=!1,T.error=null),r&&g&&t&&g.write({key:r,id:d,data:t}),t}catch(e){(0,a.vU)(e),R?y.setResource(k,[null,String(e)]):(b(k),T.isFetching=!1,T.error=String(e))}finally{R||(T.isLoaded=!0,D())}};if((0,o.d4)((()=>{if(!S){if(r&&g&&g.read({key:r,id:P})?.valid)return;F()}}),[...(0,a.Yl)(i)]),(0,o.d4)((()=>{let e=null;return g&&(e=g.subscribe((({type:e,key:t,id:i})=>{t===T.cacheKey&&i===T.cacheId&&("invalidate"!==e&&"optimistic"!==e||g.canUpdate(t)&&F())}))),()=>{b(k),(0,a.EY)(e)&&e()}}),[]),R||S){const e=y.getResource(k);if(R)e?p(T,e):y.defer(F);else if(S){if(!e)throw new Error("[Dark]: can not read app state from the server!");const[t]=e;p(T,e),r&&g&&t&&g.write({key:r,id:P,data:t})}}else I()&&!C&&w(k);const O={loading:T.isFetching,data:T.data,error:T.error,refetch:e=>F(!0,e)};return O}function p(e,t){const[i,r]=t;e.isFetching=!1,e.isLoaded=!0,e.data=i,e.error=r}function m(e,t){const{refetchQueries:i=[],onSuccess:r}=t||{},c=(0,u.P)(),d=(0,n.YT)(),o=(0,l.Y)((()=>({isFetching:!1,data:null,error:null})),[]);return[async(...t)=>{let n=null;try{o.isFetching=!0,o.error=null,c(),n=await e(...t),(0,a.EY)(r)&&r(d,n),i.forEach((e=>d.invalidate({key:e})))}catch(e){(0,a.vU)(e),o.error=String(e)}finally{o.isFetching=!1,c()}return n},{loading:o.isFetching,data:o.data,error:o.error}]}!function(e){e.PRODUCTS="products",e.PRODUCT_ITEM="product-item"}(r||(r={}));const y=void 0===globalThis.window?100:600,g=e=>new Promise((t=>setTimeout(t,e)));let P=0;const k=new Array(50).fill(null).map((()=>({id:++P,name:`Product #${P}`,description:"Lorem ipsum dolor sit amet consectetur, adipisicing elit. Nostrum blanditiis quia minus corrupti quidem. Ipsam quae ad velit repudiandae molestias unde".repeat(3)}))),T={fetchProducts:async()=>(await g(y),k.map((e=>({...e,description:null})))),fetchProduct:async e=>(w(e)||b(),await g(y),k.find((t=>t.id===e))||null),addProduct:async e=>(w(e.id)&&b(),await g(y),e.id=++P,k.push(e),e),async changeProduct(e){if(w(e.id)||b(),!e)return null;await g(y);const t=k.findIndex((t=>t.id===e.id));return-1!==t&&k.splice(t,1,e),e},async removeProduct(e){w(e)||b(),await g(y);const t=k.findIndex((t=>t.id===e));return-1!==t&&k.splice(t,1),!0}},w=e=>"number"==typeof e&&!Number.isNaN(e),b=()=>{throw new Error("Invalid id!")};function v(){return h((()=>T.fetchProducts()),{key:r.PRODUCTS,onBefore:()=>console.log("[fetch]: products")})}function I(e){return h((({id:e})=>T.fetchProduct(e)),{variables:{id:e},key:r.PRODUCT_ITEM,extractId:e=>e.id,onBefore:()=>{console.log("[fetch]: product",e)}})}function U(){return m(T.addProduct,{onSuccess:(e,t)=>{const i=e.read({key:r.PRODUCTS});if(i){const n=i.data;n.push(t),e.optimistic({key:r.PRODUCTS,data:n})}}})}function D(){return m(T.changeProduct,{onSuccess:(e,t)=>{const i=e.read({key:r.PRODUCTS});if(i){const n=i.data;n.find((e=>e.id===t.id)).name=t.name,e.optimistic({key:r.PRODUCTS,data:n}),e.optimistic({key:r.PRODUCT_ITEM,data:t,id:t.id})}}})}function R(e){return m((()=>T.removeProduct(e)),{onSuccess:t=>{const i=t.read({key:r.PRODUCTS});if(i){const n=i.data,a=n.findIndex((t=>t.id===e));-1!==a&&(n.splice(a,1),t.optimistic({key:r.PRODUCTS,data:n}))}t.delete({key:r.PRODUCT_ITEM,id:e})}})}},1523:(e,t,i)=>{i.d(t,{b:()=>c});var r=i(1261),n=i(3113),a=i(3397);function c(){const e=(0,n.M6)();(0,n.BU)(e);const t=(0,n._L)(),{location:{pathname:i}}=e,c=(0,r.Y)((()=>t?(0,a.L7)(i,t):""),[t,i]);return{path:t,url:c}}}}]);
//# sourceMappingURL=934.build.js.map