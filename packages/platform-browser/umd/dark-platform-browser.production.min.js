!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@dark-engine/core")):"function"==typeof define&&define.amd?define("DarkPlatformBrowser",["@dark-engine/core"],t):"object"==typeof exports?exports.DarkPlatformBrowser=t(require("@dark-engine/core")):e.DarkPlatformBrowser=t(e.DarkCore)}(self,(e=>(()=>{"use strict";var t={317:t=>{t.exports=e}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,r),a.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{r.r(o),r.d(o,{createPortal:()=>n,createRoot:()=>j,render:()=>L,setTrackUpdate:()=>w,useStyle:()=>U});var e=r(317),t=Symbol("portal");function n(e,n){var r;if(!(n instanceof Element))throw new Error("[Dark]: createPortal receives only Element as container!");return a(((r={})[t]=n,r.slot=e,r))}var a=(0,e.createComponent)((function(n){var r=n.slot,o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}(n,["slot"]);return(0,e.useMemo)((function(){return o[t].innerHTML=""}),[]),r}),{token:t}),i=function(n){return(0,e.detectIsComponentFactory)(n)&&n.token===t},l=function(e){return i(e)?e.props[t]:null},u=function(){function e(e){this.type="",this.sourceEvent=null,this.target=null,this.propagation=!0,this.type=e.sourceEvent.type,this.sourceEvent=e.sourceEvent,this.target=e.target}return e.prototype.stopPropagation=function(){this.propagation=!1,this.sourceEvent.stopPropagation()},e.prototype.preventDefault=function(){this.sourceEvent.preventDefault()},e.prototype.getPropagation=function(){return this.propagation},e}();function c(t){var n=t.target,r=t.eventName,o=t.handler,a=e.eventsStore.get(),i=a.get(r);if(i)i.set(n,o);else{var l=function(t){var n=a.get(r).get(t.target),o=t.target,i=null;(0,e.detectIsFunction)(n)&&n(i=new u({sourceEvent:t,target:o})),(i?i.getPropagation():o.parentElement)&&o.parentElement.dispatchEvent(new t.constructor(t.type,t))};a.set(r,new WeakMap([[n,o]])),document.addEventListener(r,l,!0),e.eventsStore.addUnsubscriber((function(){return document.removeEventListener(r,l,!0)}))}}var f,s=function(e){return e.startsWith("on")},p=function(e){return e.slice(2,e.length).toLowerCase()},m=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},v=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},d=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},y=((f={})[e.ATTR_KEY]=!0,f[e.ATTR_REF]=!0,f),g=new Map,h=null;function E(t,n){(0,e.detectIsRef)(t)&&(t.current=n)}function b(e){var t=e.tagName,n=e.element,r=e.attrName,o=e.value,a={input:function(){({value:!0,checked:!0})[r]&&(n[r]=o)},option:function(){({selected:!0})[r]&&(n[r]=o)}};a[t]&&a[t]()}function T(e){for(var t=e;t;)if(t=t.parent,i(t.instance)&&(t.nativeElement=l(t.instance)),t.nativeElement)return t;return t}function w(e){h=e}var k={hight:[],normal:[],low1:[],low2:[]},S=null,x=0,M=!1,N=null,P=function(){function e(t){this.id=++e.nextTaskId,this.time=t.time,this.timeoutMs=t.timeoutMs,this.priority=t.priority,this.forceSync=t.forceSync,this.callback=t.callback}return e.nextTaskId=0,e}();function O(t){return!!t.length&&((N=t.shift()).callback(),N.forceSync?function(e){for(;e(););I(),N=null}(e.workLoop):(n=e.workLoop,S=n,M||(M=!0,R.postMessage(null))),!0);var n}function I(){var t;Boolean(e.wipRootStore.get())||(t=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i}(k.low2,1)[0])&&(0,e.getTime)()-t.time>t.timeoutMs&&(O(k.low2),1)||O(k.hight)||O(k.normal)||requestIdleCallback((function(){return O(k.low1)||O(k.low2)}))}var A=null,R=null;A=new MessageChannel,R=A.port2,A.port1.onmessage=function(){if(S){x=(0,e.getTime)()+10;try{S()?R.postMessage(null):(N=null,M=!1,S=null,I())}catch(e){throw R.postMessage(null),e}}else M=!1},e.platform.createNativeElement=function(t){var n,r=((n={})[e.NodeType.TAG]=function(e){var t,n=e;return t=n.name,Boolean({svg:!0,circle:!0,ellipse:!0,g:!0,text:!0,tspan:!0,textPath:!0,path:!0,polygon:!0,polyline:!0,line:!0,rect:!0,use:!0,image:!0,symbol:!0,defs:!0,linearGradient:!0,radialGradient:!0,stop:!0,clipPath:!0,pattern:!0,mask:!0,marker:!0}[t])?document.createElementNS("http://www.w3.org/2000/svg",n.name):document.createElement(n.name)},n[e.NodeType.TEXT]=function(e){var t=e;return document.createTextNode(t.value)},n[e.NodeType.COMMENT]=function(e){var t=e;return document.createComment(t.value)},n);return r[t.type](t)},e.platform.requestAnimationFrame=requestAnimationFrame.bind(void 0),e.platform.scheduleCallback=function(t,n){var r,o=n||{},a=o.priority,i=void 0===a?e.TaskPriority.NORMAL:a,l=o.timeoutMs,u=void 0===l?0:l,c=o.forceSync,f=void 0!==c&&c,s=new P({time:(0,e.getTime)(),timeoutMs:u,priority:i,forceSync:f,callback:t});((r={})[e.TaskPriority.HIGH]=function(){return k.hight.push(s)},r[e.TaskPriority.NORMAL]=function(){return k.normal.push(s)},r[e.TaskPriority.LOW]=function(){return s.timeoutMs>0?k.low2.push(s):k.low1.push(s)},r)[s.priority](),I()},e.platform.shouldYeildToHost=function(){return(0,e.getTime)()>=x},e.platform.applyCommit=function(t){var n,r=((n={})[e.EffectTag.CREATE]=function(){null!==t.nativeElement&&(h&&h(t.nativeElement),function(t){var n,r=T(t).nativeElement,o=r.childNodes;0===o.length||function(e,t){for(var n,r=e;r;){if((null===(n=null==r?void 0:r.parent)||void 0===n?void 0:n.nativeElement)===t)return r.idx;r=r.parent}return-1}(t,r)>o.length-1?(n=(g.get(r)||{fragment:document.createDocumentFragment(),callback:function(){}}).fragment,g.set(r,{fragment:n,callback:function(){r.appendChild(n)}}),n.appendChild(t.nativeElement),t.markMountedToHost()):(r.insertBefore(t.nativeElement,function(t,n){var r=null;return(0,e.walkFiber)({fiber:t,onLoop:function(e){var t=e.nextFiber,o=e.stop,a=e.resetIsDeepWalking;return t.nativeElement&&t.nativeElement.parentElement===n?(r=t.nativeElement,o()):t.mountedToHost?void 0:a()}}),r}(t,r)),t.markMountedToHost()),function(t,n){var r,o;if((0,e.detectIsTagVirtualNode)(n)){var a=Object.keys(n.attrs);try{for(var i=m(a),l=i.next();!l.done;l=i.next()){var u=l.value,f=n.attrs[u];u!==e.ATTR_REF?(0,e.detectIsFunction)(f)?s(u)&&c({target:t,handler:f,eventName:p(u)}):(0,e.detectIsUndefined)(f)||y[u]||(b({tagName:n.name,value:f,attrName:u,element:t}),t.setAttribute(u,f)):E(f,t)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}}}(t.nativeElement,t.instance)}(t))},n[e.EffectTag.UPDATE]=function(){var n,r,o;null!==t.nativeElement&&(0,e.detectIsVirtualNode)(t.alternate.instance)&&(0,e.detectIsVirtualNode)(t.instance)&&(h&&h(t.nativeElement),n=t.nativeElement,r=t.alternate.instance,o=t.instance,(0,e.detectIsTextVirtualNode)(r)&&(0,e.detectIsTextVirtualNode)(o)&&r.value!==o.value?n.textContent=o.value:(0,e.detectIsTagVirtualNode)(r)&&(0,e.detectIsTagVirtualNode)(o)&&function(t,n,r){var o,a,i=new Set(d(d([],v(Object.keys(n.attrs)),!1),v(Object.keys(r.attrs)),!1));try{for(var l=m(i),u=l.next();!u.done;u=l.next()){var f=u.value,g=n.attrs[f],h=r.attrs[f];f!==e.ATTR_REF?(0,e.detectIsUndefined)(h)?t.removeAttribute(f):(0,e.detectIsFunction)(g)?s(f)&&g!==h&&c({target:t,handler:h,eventName:p(f)}):y[f]||g===h||(b({tagName:r.name,value:h,attrName:f,element:t}),t.setAttribute(f,h)):E(g,t)}}catch(e){o={error:e}}finally{try{u&&!u.done&&(a=l.return)&&a.call(l)}finally{if(o)throw o.error}}}(n,r,o))},n[e.EffectTag.DELETE]=function(){return function(t){var n=T(t);(0,e.walkFiber)({fiber:t,onLoop:function(e){var r=e.nextFiber,o=e.isReturn,a=e.resetIsDeepWalking,l=e.stop;return r===t.nextSibling||r===t.parent?l():!o&&r.nativeElement?(!i(r.instance)&&n.nativeElement.removeChild(r.nativeElement),a()):void 0}})}(t)},n[e.EffectTag.SKIP]=function(){},n);r[t.effectTag]()},e.platform.finishCommitWork=function(){var e,t;try{for(var n=m(g.values()),r=n.next();!r.done;r=n.next())(0,r.value.callback)()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}g=new Map},e.platform.detectIsPortal=i,e.platform.unmountPortal=function(e){var t=l(e.instance);t&&(t.innerHTML="")};var C=new Map;function L(t,n){if(!(n instanceof Element))throw new Error("[Dark]: render receives only Element as container!");var r=!(0,e.detectIsUndefined)(C.get(n)),o=null;r?o=C.get(n):(o=C.size,C.set(n,o),n.innerHTML=""),e.platform.scheduleCallback((function(){e.rootStore.set(o);var a=e.currentRootStore.get(),i=new e.Fiber({nativeElement:n,instance:new e.TagVirtualNode({name:e.ROOT,children:(0,e.flatten)([t||(0,e.createEmptyVirtualNode)()])}),alternate:a,effectTag:r?e.EffectTag.UPDATE:e.EffectTag.CREATE});a&&(a.alternate=null),e.fiberMountStore.reset(),e.wipRootStore.set(i),e.nextUnitOfWorkStore.set(i)}),{priority:e.TaskPriority.NORMAL,forceSync:e.isLayoutEffectsZone.get()})}function j(t){return{render:function(e){return L(e,t)},unmount:function(){var n=C.get(t);(0,e.unmountRoot)(n,(function(){C.delete(t),t.innerHTML=""}))}}}var F=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},D=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};function H(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=(0,e.useMemo)((function(){return t.map((function(t,r){return t+((0,e.detectIsUndefined)(n[r])?"":n[r])})).join("").replace(/;\s*/gm,";").replace(/:\s*/gm,":").trim()}),D([t],F(n),!1));return o}function U(e){return e(H)}})(),o})()));
//# sourceMappingURL=dark-platform-browser.production.min.js.map