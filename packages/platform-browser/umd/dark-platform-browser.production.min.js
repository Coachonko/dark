!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@dark-engine/core")):"function"==typeof define&&define.amd?define("DarkPlatformBrowser",["@dark-engine/core"],t):"object"==typeof exports?exports.DarkPlatformBrowser=t(require("@dark-engine/core")):e.DarkPlatformBrowser=t(e.DarkCore)}(self,(e=>(()=>{"use strict";var t={317:t=>{t.exports=e}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,r),a.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{r.r(o),r.d(o,{createPortal:()=>n,createRoot:()=>A,render:()=>S,useStyle:()=>j});var e=r(317),t=Symbol("portal");function n(e,n){var r;if(!(n instanceof Element))throw new Error("[Dark]: createPortal receives only Element as container!");return a(((r={})[t]=n,r.slot=e,r))}var a=(0,e.createComponent)((function(n){var r=n.slot,o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}(n,["slot"]);return(0,e.useMemo)((function(){return o[t].innerHTML=""}),[]),r}),{token:t}),i=function(n){return(0,e.detectIsComponentFactory)(n)&&n.token===t},l=function(e){return i(e)?e.props[t]:null},u=function(){function e(e){this.type="",this.sourceEvent=null,this.target=null,this.propagation=!0,this.type=e.sourceEvent.type,this.sourceEvent=e.sourceEvent,this.target=e.target}return e.prototype.stopPropagation=function(){this.propagation=!1,this.sourceEvent.stopPropagation()},e.prototype.preventDefault=function(){this.sourceEvent.preventDefault()},e.prototype.getPropagation=function(){return this.propagation},e}();function c(t){var n=t.target,r=t.eventName,o=t.handler,a=e.eventsHelper.get(),i=a.get(r);if(i)i.set(n,o);else{var l=function(t){var n=a.get(r).get(t.target),o=t.target,i=null;(0,e.detectIsFunction)(n)&&n(i=new u({sourceEvent:t,target:o})),(i?i.getPropagation():o.parentElement)&&o.parentElement.dispatchEvent(new t.constructor(t.type,t))};a.set(r,new WeakMap([[n,o]])),document.addEventListener(r,l,!0),e.eventsHelper.addUnsubscriber((function(){return document.removeEventListener(r,l,!0)}))}}var f,s=function(e){return e.startsWith("on")},p=function(e){return e.slice(2,e.length).toLowerCase()},m=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},v=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},d=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},y=((f={})[e.ATTR_KEY]=!0,f[e.ATTR_REF]=!0,f),g=new Map;function h(t,n){(0,e.detectIsRef)(t)&&(t.current=n)}function E(e){var t=e.tagName,n=e.element,r=e.attrName,o=e.value,a={input:function(){({value:!0,checked:!0})[r]&&(n[r]=o)},option:function(){({selected:!0})[r]&&(n[r]=o)}};a[t]&&a[t]()}var b={hight:[],normal:[],low:[]},T=null,w=0,k=!1,N=function(){function e(t){this.id=++e.nextTaskId,this.time=t.time,this.timeoutMs=t.timeoutMs,this.priority=t.priority,this.callback=t.callback}return e.nextTaskId=0,e}();function x(t){return!!t.length&&(t.shift().callback(),n=e.workLoop,T=n,k||(k=!0,I.postMessage(null)),!0);var n}function M(){var t;Boolean(e.wipRootHelper.get())||(t=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i}(b.low,1)[0])&&t.timeoutMs>0&&(0,e.getTime)()-t.time>t.timeoutMs&&(x(b.low),1)||x(b.hight)||x(b.normal)||requestIdleCallback((function(){return x(b.low)}))}var O,P=null,I=null;P=new MessageChannel,I=P.port2,P.port1.onmessage=function(){if(T){w=(0,e.getTime)()+10;try{T()?I.postMessage(null):(k=!1,T=null,M())}catch(e){throw I.postMessage(null),e}}else k=!1},function(e){e[e.HIGH=2]="HIGH",e[e.NORMAL=1]="NORMAL"}(O||(O={})),e.platform.scheduleCallback=function(t,n){var r,o=n||{},a=o.priority,i=void 0===a?e.TaskPriority.NORMAL:a,l=o.timeoutMs,u=new N({time:(0,e.getTime)(),timeoutMs:l,priority:i,callback:t});((r={})[e.TaskPriority.HIGH]=function(){return b.hight.push(u)},r[e.TaskPriority.NORMAL]=function(){return b.normal.push(u)},r[e.TaskPriority.LOW]=function(){return b.low.push(u)},r)[u.priority](),M()},e.platform.shouldYeildToHost=function(){return(0,e.getTime)()>=w},e.platform.createNativeElement=function(t){if(!(0,e.detectIsVirtualNode)(t.instance))throw new Error("[Dark]: createNativeElement receives only virtual node!");return function(t){var n,r=((n={})[e.NodeType.TAG]=function(e){var t,n=e;return t=n.name,Boolean({svg:!0,circle:!0,ellipse:!0,g:!0,text:!0,tspan:!0,textPath:!0,path:!0,polygon:!0,polyline:!0,line:!0,rect:!0,use:!0,image:!0,symbol:!0,defs:!0,linearGradient:!0,radialGradient:!0,stop:!0,clipPath:!0,pattern:!0,mask:!0,marker:!0}[t])?document.createElementNS("http://www.w3.org/2000/svg",n.name):document.createElement(n.name)},n[e.NodeType.TEXT]=function(e){var t=e;return document.createTextNode(t.value)},n[e.NodeType.COMMENT]=function(e){var t=e;return document.createComment(t.value)},n);return r[t.type](t)}(t.instance)},e.platform.applyCommit=function(t){var n,r,o,a=function(e){for(var t=e;t;)if(t=t.parent,i(t.instance)&&(t.nativeElement=l(t.instance)),t.nativeElement)return t;return t}(t);if(null!==t.nativeElement&&t.effectTag===e.EffectTag.PLACEMENT)!function(t,n){var r,o=n.nativeElement,a=o.childNodes;0===a.length||function(e,t){for(var n,r=e;r;){if((null===(n=null==r?void 0:r.parent)||void 0===n?void 0:n.nativeElement)===t)return r.idx;r=r.parent}return-1}(t,o)>a.length-1?(r=(g.get(o)||{fragment:document.createDocumentFragment(),callback:function(){}}).fragment,g.set(o,{fragment:r,callback:function(){o.appendChild(r)}}),r.appendChild(t.nativeElement),t.markMountedToHost()):(o.insertBefore(t.nativeElement,function(t,n){var r=null;return(0,e.walkFiber)({fiber:t,onLoop:function(e){var t=e.nextFiber,o=e.stop,a=e.resetIsDeepWalking;return t.nativeElement&&t.nativeElement.parentElement===n?(r=t.nativeElement,o()):t.mountedToHost?void 0:a()}}),r}(t,o)),t.markMountedToHost()),function(t,n){var r,o;if((0,e.detectIsTagVirtualNode)(n)){var a=Object.keys(n.attrs);try{for(var i=m(a),l=i.next();!l.done;l=i.next()){var u=l.value,f=n.attrs[u];u!==e.ATTR_REF?(0,e.detectIsFunction)(f)?s(u)&&c({target:t,handler:f,eventName:p(u)}):(0,e.detectIsUndefined)(f)||y[u]||(E({tagName:n.name,value:f,attrName:u,element:t}),t.setAttribute(u,f)):h(f,t)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}}}(t.nativeElement,t.instance)}(t,a);else if(null!==t.nativeElement&&t.effectTag===e.EffectTag.UPDATE){if(!(0,e.detectIsVirtualNode)(t.alternate.instance)||!(0,e.detectIsVirtualNode)(t.instance))return;var u=t.alternate.instance,f=t.instance;n=t.nativeElement,r=u,o=f,(0,e.detectIsTextVirtualNode)(r)&&(0,e.detectIsTextVirtualNode)(o)&&r.value!==o.value?n.textContent=o.value:(0,e.detectIsTagVirtualNode)(r)&&(0,e.detectIsTagVirtualNode)(o)&&function(t,n,r){var o,a,i=new Set(d(d([],v(Object.keys(n.attrs)),!1),v(Object.keys(r.attrs)),!1));try{for(var l=m(i),u=l.next();!u.done;u=l.next()){var f=u.value,g=n.attrs[f],b=r.attrs[f];f!==e.ATTR_REF?(0,e.detectIsUndefined)(b)?t.removeAttribute(f):(0,e.detectIsFunction)(g)?s(f)&&g!==b&&c({target:t,handler:b,eventName:p(f)}):y[f]||g===b||(E({tagName:r.name,value:b,attrName:f,element:t}),t.setAttribute(f,b)):h(g,t)}}catch(e){o={error:e}}finally{try{u&&!u.done&&(a=l.return)&&a.call(l)}finally{if(o)throw o.error}}}(n,r,o)}else t.effectTag===e.EffectTag.DELETION&&function(t,n){(0,e.walkFiber)({fiber:t,onLoop:function(e){var r=e.nextFiber,o=e.isReturn,a=e.resetIsDeepWalking,l=e.stop;return r===t.nextSibling||r===t.parent?l():!o&&r.nativeElement?(!i(r.instance)&&n.nativeElement.removeChild(r.nativeElement),a()):void 0}})}(t,a)},e.platform.finishCommitWork=function(){var e,t;try{for(var n=m(g.values()),r=n.next();!r.done;r=n.next())(0,r.value.callback)()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}g=new Map},e.platform.detectIsPortal=i,e.platform.unmountPortal=function(e){var t=l(e.instance);t&&(t.innerHTML="")};var H=new Map;function S(t,n){if(!(n instanceof Element))throw new Error("[Dark]: render receives only Element as container!");var r=!(0,e.detectIsUndefined)(H.get(n)),o=null;r?o=H.get(n):(o=H.size,H.set(n,o),n.innerHTML=""),e.platform.scheduleCallback((function(){e.effectStoreHelper.set(o);var a=e.currentRootHelper.get(),i=new e.Fiber({nativeElement:n,instance:new e.TagVirtualNode({name:e.ROOT,children:(0,e.flatten)([t||(0,e.createEmptyVirtualNode)()])}),alternate:a,effectTag:r?e.EffectTag.UPDATE:e.EffectTag.PLACEMENT});a&&(a.alternate=null),e.fiberMountHelper.reset(),e.wipRootHelper.set(i),e.nextUnitOfWorkHelper.set(i)}),{priority:e.TaskPriority.NORMAL})}function A(t){return{render:function(e){return S(e,t)},unmount:function(){var n=H.get(t);(0,e.unmountRoot)(n,(function(){H.delete(t),t.innerHTML=""}))}}}var R=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},L=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};function C(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=(0,e.useMemo)((function(){return t.map((function(t,r){return t+((0,e.detectIsUndefined)(n[r])?"":n[r])})).join("").replace(/;\s*/gm,";").replace(/:\s*/gm,":").trim()}),L([t],R(n),!1));return o}function j(e){return e(C)}})(),o})()));
//# sourceMappingURL=dark-platform-browser.production.min.js.map