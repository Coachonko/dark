!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@dark-engine/core")):"function"==typeof define&&define.amd?define("DarkPlatformBrowser",["@dark-engine/core"],t):"object"==typeof exports?exports.DarkPlatformBrowser=t(require("@dark-engine/core")):e.DarkPlatformBrowser=t(e.DarkCore)}(self,(e=>(()=>{"use strict";var t={317:t=>{t.exports=e}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};return(()=>{r.r(a),r.d(a,{createPortal:()=>n,render:()=>M});var e=r(317),t=Symbol("portal");function n(e,n){var r;return n instanceof Element?o(((r={})[t]=n,r.slot=e,r)):null}var o=(0,e.createComponent)((function(n){var r=n.slot,a=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(n,["slot"]);return(0,e.useMemo)((function(){return a[t].innerHTML=""}),[]),r}),{token:t}),i=function(n){return(0,e.detectIsComponentFactory)(n)&&n.token===t},l=function(e){return i(e)?e.props[t]:null},c=function(){function e(e){this.type="",this.sourceEvent=null,this.target=null,this.propagation=!0,this.type=e.sourceEvent.type,this.sourceEvent=e.sourceEvent,this.target=e.target}return e.prototype.stopPropagation=function(){this.propagation=!1,this.sourceEvent.stopPropagation()},e.prototype.preventDefault=function(){this.sourceEvent.preventDefault()},e.prototype.getPropagation=function(){return this.propagation},e}();function u(t){var n=t.target,r=t.eventName,a=t.handler,o=e.eventsHelper.get(),i=o.get(r);i?i.set(n,a):(o.set(r,new WeakMap([[n,a]])),document.addEventListener(r,(function(t){var n=o.get(r).get(t.target),a=t.target,i=null;(0,e.detectIsFunction)(n)&&n(i=new c({sourceEvent:t,target:a})),(i?i.getPropagation():a.parentElement)&&a.parentElement.dispatchEvent(new t.constructor(t.type,t))}),!0))}var f=function(e){return e.startsWith("on")},s=function(e){return e.slice(2,e.length).toLowerCase()},p=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},d=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},v=function(e,t,n){if(n||2===arguments.length)for(var r,a=0,o=t.length;a<o;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},m=[e.ATTR_KEY,e.ATTR_REF];function g(t,n){(0,e.detectIsRef)(t)&&(t.current=n)}function E(e){var t=e.tagName,n=e.element,r=e.attrName,a=e.value,o={input:function(){({value:!0,checked:!0})[r]&&(n[r]=a)},option:function(){({selected:!0})[r]&&(n[r]=a)}};o[t]&&o[t]()}var y,b=new Map,h=new Map;function T(e,t){for(var n=e,r=!0;n;){if(n.nativeElement&&n.nativeElement.parentElement===t)return n.nativeElement;n.nativeElement&&!n.mountedToHost&&(r=!1),n.child&&r?n=n.child:n.nextSibling?(r=!0,n=n.nextSibling):n.parent&&n.parent.nativeElement!==t?(r=!1,n=n.parent):n=null}return null}!function(e){e[e.HIGH=2]="HIGH",e[e.NORMAL=1]="NORMAL"}(y||(y={}));var x=[],w=null,N=0,S=!1,I=function(){function e(t){this.id=++e.nextTaskId,this.priority=t.priority,this.callback=t.callback}return e.nextTaskId=0,e}();function k(){var t;Boolean(e.nextUnitOfWorkHelper.get())||x.length>0&&(x.shift().callback(),t=e.workLoop,w=t,S||(S=!0,H.postMessage(null)))}var O=null,H=null;O=new MessageChannel,H=O.port2,O.port1.onmessage=function(){if(w){N=(0,e.getTime)()+5;try{w()?H.postMessage(null):(S=!1,w=null,k())}catch(e){throw H.postMessage(null),e}}else S=!1},e.platform.raf=window.requestAnimationFrame.bind(void 0),e.platform.scheduleCallback=function(e,t){void 0===t&&(t=y.NORMAL);var n=new I({priority:t,callback:e});x.push(n),k()},e.platform.shouldYeildToHost=function(){return(0,e.getTime)()>=N},e.platform.createNativeElement=function(t){if(!(0,e.detectIsVirtualNode)(t.instance))throw new Error("createDomElement receives only Element into fiber!");return n=t.instance,(r={})[e.NodeType.TAG]=function(e){var t,n=e;return t=n.name,Boolean({svg:!0,circle:!0,ellipse:!0,g:!0,text:!0,tspan:!0,textPath:!0,path:!0,polygon:!0,polyline:!0,line:!0,rect:!0,use:!0,image:!0,symbol:!0,defs:!0,linearGradient:!0,radialGradient:!0,stop:!0,clipPath:!0,pattern:!0,mask:!0,marker:!0}[t])?document.createElementNS("http://www.w3.org/2000/svg",n.name):document.createElement(n.name)},r[e.NodeType.TEXT]=function(e){var t=e;return document.createTextNode(t.value)},r[e.NodeType.COMMENT]=function(t){var n=t;return n.value===e.EMPTY_NODE?null:document.createComment(n.value)},r[n.type](n);var n,r},e.platform.applyCommits=function(t){var n,r,a,o=e.fromHookUpdateHelper.get(),c=function(e){var t=e.parent;if(i(e.instance))return e;for(;t&&!t.nativeElement;)i(t.instance)?t.nativeElement=l(t.instance):t=t.parent;return t}(t),y=c.nativeElement;if(null!==t.nativeElement&&t.effectTag===e.EffectTag.PLACEMENT){var x=h.get(y),w=c.alternate?!(0,e.detectIsUndefined)(x)&&function(t,n){for(var r=t;r;){if(r.alternate){var a=r.alternate;return(0,e.detectIsCommentVirtualNode)(a.instance)&&a.instance.value===e.EMPTY_NODE}if((r=r.parent)===n)return!1}return!1}(t,c)?x:null===x?null:T(t,y):o?T(t,y):null;if(h.set(y,w),w)y.insertBefore(t.nativeElement,w),t.mountedToHost=!0,function(t,n){var r=t;do{if(!r)return!1;if((r=r.nextSibling||r.parent.nextSibling)&&r.parent===n)break}while(!r);return r.effectTag===e.EffectTag.UPDATE}(t,c)&&h.delete(y);else{var N=b.get(y);(0,e.detectIsUndefined)(N)&&(N=document.createDocumentFragment(),b.set(y,N)),N.appendChild(t.nativeElement),t.mountedToHost=!0,function(e,t){var n=e;if(n.nextSibling&&i(n.nextSibling.instance))return!1;for(;!n.nextSibling;)if((n=n.parent)===t||n.nativeElement)return!1;return!0}(t,c)||(y.appendChild(N),b.delete(y),h.delete(y))}!function(t,n){var r,a;if((0,e.detectIsTagVirtualNode)(n)){var o=Object.keys(n.attrs);try{for(var i=p(o),l=i.next();!l.done;l=i.next()){var c=l.value,d=(0,e.getAttribute)(n,c);c!==e.ATTR_REF?(0,e.detectIsFunction)(d)?f(c)&&u({target:t,handler:d,eventName:s(c)}):(0,e.detectIsUndefined)(d)||m.includes(c)||(E({tagName:n.name,value:d,attrName:c,element:t}),t.setAttribute(c,d)):g(d,t)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(a=i.return)&&a.call(i)}finally{if(r)throw r.error}}}}(t.nativeElement,t.instance)}else if(null!==t.nativeElement&&t.effectTag===e.EffectTag.UPDATE){if(!(0,e.detectIsVirtualNode)(t.alternate.instance)||!(0,e.detectIsVirtualNode)(t.instance))return;var S=t.alternate.instance,I=t.instance;n=t.nativeElement,r=S,a=I,(0,e.detectIsTextVirtualNode)(r)&&(0,e.detectIsTextVirtualNode)(a)&&r.value!==a.value?n.textContent=a.value:(0,e.detectIsTagVirtualNode)(r)&&(0,e.detectIsTagVirtualNode)(a)&&function(t,n,r){var a,o,i=new Set(v(v([],d(Object.keys(n.attrs)),!1),d(Object.keys(r.attrs)),!1));try{for(var l=p(i),c=l.next();!c.done;c=l.next()){var y=c.value,b=(0,e.getAttribute)(n,y),h=(0,e.getAttribute)(r,y);y!==e.ATTR_REF?(0,e.detectIsUndefined)(h)?t.removeAttribute(y):(0,e.detectIsFunction)(b)?f(y)&&b!==h&&u({target:t,handler:h,eventName:s(y)}):(0,e.detectIsUndefined)(h)||b===h||m.includes(y)||(E({tagName:r.name,value:h,attrName:y,element:t}),t.setAttribute(y,h)):g(b,t)}}catch(e){a={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(a)throw a.error}}}(n,r,a)}else t.effectTag===e.EffectTag.DELETION&&function(t,n){var r=t,a=!0,o=!1;if(!(0,e.detectIsCommentVirtualNode)(r.instance)||r.nativeElement)for(;r;)if(o||(r.nativeElement&&(!i(r.instance)&&n.removeChild(r.nativeElement),a=!1),!t.transposition&&(0,e.detectIsComponentFactory)(r.instance)&&(0,e.runEffectCleanup)(r.hook)),r.child&&a)r=r.child,o=!1;else if(r.nextSibling&&r.nextSibling!==t.nextSibling){if(r.nextSibling.effectTag===e.EffectTag.DELETION)return;a=!0,o=!1,r=r.nextSibling}else r.parent&&r!==t&&r.parent!==t&&r.parent!==t.parent?(a=!1,o=!0,r=r.parent):r=null}(t,y)},e.platform.detectIsPortal=i,e.platform.unmountPortal=function(e){for(var t=e,n=!0,r=!1;t;)!r&&i(t.instance)&&(l(t.instance).innerHTML=""),t.portalHost||(n=!1),t.child&&n?(t=t.child,r=!1):t.nextSibling&&t.nextSibling!==e.nextSibling?(n=!0,r=!1,t=t.nextSibling):t.parent&&t!==e&&t.parent!==e&&t.parent!==e.parent?(n=!1,r=!0,t=t.parent):t=null};var P=new Map;function M(t,n){if(!(n instanceof Element))throw new Error("render expects to receive container as Element!");var r=!(0,e.detectIsUndefined)(P.get(n));if(r){var a=P.get(n);e.effectStoreHelper.set(a)}else{var o=P.size;P.set(n,o),e.effectStoreHelper.set(o),n.innerHTML=""}var i=(0,e.getRootId)();e.platform.scheduleCallback((function(){e.effectStoreHelper.set(i),h=new Map;var a=e.currentRootHelper.get(),o=new e.Fiber({nativeElement:n,instance:new e.TagVirtualNode({name:e.ROOT,children:(0,e.flatten)([t])}),alternate:a,effectTag:r?e.EffectTag.UPDATE:e.EffectTag.PLACEMENT});a&&(a.alternate=null),e.fiberMountHelper.reset(),e.wipRootHelper.set(o),e.nextUnitOfWorkHelper.set(o),e.deletionsHelper.get().forEach((function(t){return t.effectTag=e.EffectTag.UPDATE})),e.deletionsHelper.set([])}),y.HIGH)}})(),a})()));
//# sourceMappingURL=dark-platform-browser.production.min.js.map